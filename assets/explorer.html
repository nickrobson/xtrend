<!DOCTYPE html>
<html>
    <head>
        <title>API Explorer</title>
        <link rel="stylesheet" type="text/css" href="//rawgit.com/abodelot/jquery.json-viewer/master/json-viewer/jquery.json-viewer.css"></link>
        <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/6.3.1/css/foundation.min.css"></link>
    </head>
    <body>
        <div style="height: 50px"></div>
        <div class="row">
            <div class="columns small-12">
                <h3>SENG3011 - Cool Bananas</h3>
            </div>
        </div>
        <div class="row">
            <div class="columns small-12">
                <h4>API Explorer</h4>
            </div>
        </div>
        <div style="height: 30px"></div>
        <form id="explore">
            <div class="row">
                <div class="columns">
                    <label>Instrument IDs
                        <input type="text" id="explore-rics" name="rics" placeholder="Enter instrument IDs...">
                    </label>
                </div>
            </div>
            <div class="row">
                <div class="columns">
                    <label>Topic Codes
                        <input type="text" id="explore-topics" name="topics" placeholder="Enter topic codes...">
                    </label>
                </div>
            </div>
            <div class="row">
                <div class="columns">
                    <label>Start Date
                        <input type="datetime-local" id="explore-start-date" name="startdate">
                    </label>
                </div>
            </div>
            <div class="row">
                <div class="columns">
                    <label>End Date
                        <input type="datetime-local" id="explore-end-date" name="enddate">
                    </label>
                </div>
            </div>
            <!-- <div class="row">
                <label>Unique Results?
                    <input type="checkbox" id="explore-uniq" name="uniq" value="0">
                </label>
            </div> -->
            
            <div class="row">
                <div class="columns small-12 medium-8 small-centered medium-centered">
                    <button class="button" type="button" onclick="submitExplore()" style="width: 100%">Submit</button>
                </div>
            </div>
        </form>
        <div class="row">
            <div class="columns">
                <pre id="explore-result"></pre>
            </div>
        </div>
        <script type="text/javascript" src="//code.jquery.com/jquery-2.1.3.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/foundation/6.3.1/js/foundation.min.js"></script>
        <script type="text/javascript" src="//rawgit.com/abodelot/jquery.json-viewer/master/json-viewer/jquery.json-viewer.js"></script>
        <script type="text/javascript">
            function getValueOf(id) {
                return document.getElementById(id).value;
            }
            function submitExplore() {
                var rics = getValueOf('explore-rics');
                var topics = getValueOf('explore-topics');
                var startDate = getValueOf('explore-start-date');
                var endDate = getValueOf('explore-end-date');

                if (startDate.length < 17) {
                    startDate += ':00';
                }
                
                if (startDate.length < 20) {
                    startDate += '.000';
                }

                if (endDate.length < 17) {
                    endDate += ':00';
                }
                
                if (endDate.length < 20) {
                    endDate += '.000';
                }

                var query =   "?rics="      + encodeURIComponent(rics)
                            + "&topics="    + encodeURIComponent(topics)
                            + "&startdate=" + encodeURIComponent(startDate + 'Z')
                            + "&enddate="   + encodeURIComponent(endDate + 'Z');

                console.log(query);

                var xhr = new XMLHttpRequest();
                xhr.open("GET", "/coolbananas/api/" + query);
                xhr.onload = function() {
                    if (xhr.readyState === xhr.DONE) {
                        var data = JSON.parse(xhr.responseText);
                        $('#explore-result').jsonViewer(data, {collapsed: false, withQuotes: true});
                    }
                };
                xhr.send();
            }
        </script>
    </body>
</html>
